{"version":3,"file":"plugin.cjs.js","sources":["esm/index.js","esm/web.js"],"sourcesContent":["import { registerPlugin } from \"@capacitor/core\";\nconst CameraPreview = registerPlugin(\"CameraPreview\", {\n    web: () => import(\"./web\").then((m) => new m.CameraPreviewWeb()),\n});\nexport * from \"./definitions\";\nexport { CameraPreview };\n//# sourceMappingURL=index.js.map","import { WebPlugin } from \"@capacitor/core\";\nexport class CameraPreviewWeb extends WebPlugin {\n    constructor() {\n        super({\n            name: \"CameraPreview\",\n            platforms: [\"web\"],\n        });\n        /**\n         *  track which camera is used based on start options\n         *  used in capture\n         */\n        this.isBackCamera = false;\n    }\n    async start(options) {\n        var _a;\n        await navigator.mediaDevices\n            .getUserMedia({\n            audio: !options.disableAudio,\n            video: true,\n        })\n            .then((stream) => {\n            // Stop any existing stream so we can request media with different constraints based on user input\n            stream.getTracks().forEach((track) => track.stop());\n        })\n            .catch((error) => {\n            Promise.reject(error);\n        });\n        const video = document.getElementById(\"video\");\n        const parent = document.getElementById((options === null || options === void 0 ? void 0 : options.parent) || \"\");\n        if (!video) {\n            const videoElement = document.createElement(\"video\");\n            videoElement.id = \"video\";\n            videoElement.setAttribute(\"class\", (options === null || options === void 0 ? void 0 : options.className) || \"\");\n            // Don't flip video feed if camera is rear facing\n            if (options.position !== \"rear\") {\n                videoElement.setAttribute(\"style\", \"-webkit-transform: scaleX(-1); transform: scaleX(-1);\");\n            }\n            const userAgent = navigator.userAgent.toLowerCase();\n            const isSafari = userAgent.includes(\"safari\") && !userAgent.includes(\"chrome\");\n            // Safari on iOS needs to have the autoplay, muted and playsinline attributes set for video.play() to be successful\n            // Without these attributes videoElement.play() will throw a NotAllowedError\n            // https://developer.apple.com/documentation/webkit/delivering_video_content_for_safari\n            if (isSafari) {\n                videoElement.setAttribute(\"autoplay\", \"true\");\n                videoElement.setAttribute(\"muted\", \"true\");\n                videoElement.setAttribute(\"playsinline\", \"true\");\n            }\n            parent === null || parent === void 0 ? void 0 : parent.appendChild(videoElement);\n            if ((_a = navigator === null || navigator === void 0 ? void 0 : navigator.mediaDevices) === null || _a === void 0 ? void 0 : _a.getUserMedia) {\n                const constraints = {\n                    video: {\n                        width: { ideal: options.width },\n                        height: { ideal: options.height },\n                    },\n                };\n                if (options.position === \"rear\") {\n                    constraints.video.facingMode =\n                        \"environment\";\n                    this.isBackCamera = true;\n                }\n                else {\n                    this.isBackCamera = false;\n                }\n                const self = this;\n                await navigator.mediaDevices.getUserMedia(constraints).then((stream) => {\n                    if (document.getElementById(\"video\")) {\n                        // video.src = window.URL.createObjectURL(stream);\n                        videoElement.srcObject = stream;\n                        videoElement.play();\n                        Promise.resolve({});\n                    }\n                    else {\n                        self.stopStream(stream);\n                        Promise.reject(new Error(\"camera already stopped\"));\n                    }\n                }, (err) => {\n                    Promise.reject(new Error(err));\n                });\n            }\n            return { depthParamsSupported: false };\n        }\n        else {\n            Promise.reject(new Error(\"camera already started\"));\n            return { depthParamsSupported: false };\n        }\n    }\n    stopStream(stream) {\n        if (stream) {\n            const tracks = stream.getTracks();\n            for (const track of tracks)\n                track.stop();\n        }\n    }\n    async stop() {\n        const video = document.getElementById(\"video\");\n        if (video) {\n            video.pause();\n            this.stopStream(video.srcObject);\n            video.remove();\n        }\n    }\n    async capture(options) {\n        return new Promise((resolve, reject) => {\n            const video = document.getElementById(\"video\");\n            if (!(video === null || video === void 0 ? void 0 : video.srcObject)) {\n                reject(new Error(\"camera is not running\"));\n                return;\n            }\n            // video.width = video.offsetWidth;\n            let base64EncodedImage;\n            if (video && video.videoWidth > 0 && video.videoHeight > 0) {\n                const canvas = document.createElement(\"canvas\");\n                const context = canvas.getContext(\"2d\");\n                canvas.width = video.videoWidth;\n                canvas.height = video.videoHeight;\n                // flip horizontally back camera isn't used\n                if (!this.isBackCamera) {\n                    context === null || context === void 0 ? void 0 : context.translate(video.videoWidth, 0);\n                    context === null || context === void 0 ? void 0 : context.scale(-1, 1);\n                }\n                context === null || context === void 0 ? void 0 : context.drawImage(video, 0, 0, video.videoWidth, video.videoHeight);\n                if ((options.format || \"jpeg\") === \"jpeg\") {\n                    base64EncodedImage = canvas\n                        .toDataURL(\"image/jpeg\", (options.quality || 85) / 100.0)\n                        .replace(\"data:image/jpeg;base64,\", \"\");\n                }\n                else {\n                    base64EncodedImage = canvas\n                        .toDataURL(\"image/png\")\n                        .replace(\"data:image/png;base64,\", \"\");\n                }\n            }\n            resolve({\n                value: base64EncodedImage,\n            });\n        });\n    }\n    async captureSample(_options) {\n        return this.capture(_options);\n    }\n    async stopRecordVideo() {\n        throw new Error(\"stopRecordVideo not supported under the web platform\");\n    }\n    async startRecordVideo(_options) {\n        console.log(\"startRecordVideo\", _options);\n        throw new Error(\"startRecordVideo not supported under the web platform\");\n    }\n    async getSupportedFlashModes() {\n        throw new Error(\"getSupportedFlashModes not supported under the web platform\");\n    }\n    async getHorizontalFov() {\n        throw new Error(\"getHorizontalFov not supported under the web platform\");\n    }\n    async setFlashMode(_options) {\n        throw new Error(`setFlashMode not supported under the web platform${_options}`);\n    }\n    async flip() {\n        throw new Error(\"flip not supported under the web platform\");\n    }\n    async getSupportedPictureSizes() {\n        throw new Error(\"getSupportedPictureSizes not supported under the web platform\");\n    }\n    async setOpacity(_options) {\n        const video = document.getElementById(\"video\");\n        if (!!video && !!_options.opacity)\n            video.style.setProperty(\"opacity\", _options.opacity.toString());\n    }\n}\n//# sourceMappingURL=web.js.map"],"names":["registerPlugin","WebPlugin"],"mappings":"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"}